<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M5CPZDQB');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png" />
    <meta name="msapplication-TileImage" content="/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBR IR ユーザー登録</title>
    <link href="style/style.css" rel="stylesheet">
  </head>
  <style>
    body {
      font-family: "Noto Sans JP", sans-serif;
      font-size: 1rem;
      line-height: 1.6;
      color: #333;
      background-color: #fff;
      padding: 1.25rem;
      max-width: 100%;
    }

    .top-section-box {
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 0.625rem 0 1.5rem 0;
    }

    .notice-box {
      border: 0.125rem solid #666;
      background-color: #353535;
      color: white;
      padding: 0.625rem;
      margin: 0.625rem auto;
      width: 80%;
      text-align: left;
      border-radius: 0.3125rem;
    }

    .notice-box ul {
      list-style-type: square;
      padding-left: 1.25rem;
    }

    .notice-box li {
      margin-bottom: 0.3125rem;
    }

    .notice-box a:visited {
      color: #cc00cc;
    }

    .notice-box a {
      color: #bce2e8;
    }

    button {
        background-color: #f5f5f5;  /* 淡い灰色背景 */
        color: #000;  /* 黒文字 */
        border: 1px solid #888;  /* 灰色の縁取り */
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        margin-top: 1rem;
        font-weight: bold;
        text-decoration: none;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    /* ボタンが無効化された時のスタイル（その他のボタン） */
    button:disabled {
        background-color: #dcdcdc; /* グレー背景 */
        color: #888; /* グレー文字 */
        cursor: not-allowed; /* カーソルを無効化表示 */
        border: 1px solid #ccc; /* 境界線も薄いグレーに */
    }

    .button {
        background-color: #f5f5f5;
        color: #000;
        border: 1px solid #888;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        margin-bottom: 1rem;
        font-weight: bold;
        text-decoration: none;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease, transform 0.2s ease;
        display: inline-block;
    }

    /* チェックボックスを大きくする */
    input[type="checkbox"] {
        transform: scale(1.5);  /* チェックボックスを1.5倍に拡大 */
        margin-right: 0.5rem;
        margin-top: 0.75rem;
    }

    /* チェックボックスのラベルも大きく */
    label {
        font-size: 1.2rem;      /* ラベルの文字サイズを大きく */
        line-height: 1.5rem;    /* 行間を広げて読みやすく */
        cursor: pointer;       /* クリック可能にする */
    }

    .label-disabled {
      color: #888;          /* グレーっぽく */
      border-color: #ccc;   /* 薄い境界線 */
      cursor: not-allowed;
      background-color: #dcdcdc;
      pointer-events: none; /* クリック無効 */
    }

    .subtext {
      font-size: 0.9rem;
      color: #555;
      margin: 0.5rem;
    }

    .authInput #email {
      margin-bottom: 0.5rem;
    }
  </style>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M5CPZDQB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <center>
      <strong><span style="font-size: 2rem;">DBR IR ユーザー登録</span></strong><br>

      <!-- ここに注意書きの枠を追加 -->
      <div class="notice-box">
        <ul>
          <li>DBR IRにユーザー登録します</li>
          <li>登録にはメールアドレスと8文字以上のパスワードが必要です</li>
          <li>登録後、 noreply@dbr-ir.firebaseapp.com から確認メールが送信されます メール内のリンクをクリックして登録を完了してください</li>
          <li>確認メールが届かない場合、迷惑メールフォルダをチェックしてください</li>
          <details>
            <summary>利用上の注意事項</summary>
            <ul>
                <li>メールアドレス、パスワードをアカウント情報として利用します<br>
                メールアドレスは認証またはアカウント管理に必要な通知以外の目的では利用せず、第三者への提供は行いません<br>
                パスワードはFirebase Authenticationで管理され、当方が閲覧することはできません</li> 
                <li>不測の事態による情報流出、その他サービスの利用により発生した損害について、当方では一切の責任を負いかねます</li>
                <li>虚偽のデータ入力やなりすましなど、当方が不適切と判断する行為を確認した場合、予告なくアカウントを停止・削除する場合があります</li>
                <li>アップロードされたプレーデータは、曲単位での削除ができません（記録の全削除は可能です）<br>
                ランキングやマイページで表示したくないデータについては、アップロード前に手動で削除してください</li>
              </ul>
          </details>
          <details>
            <summary>メールの文面を確認する</summary>
            <div style="max-width: 600px;">
                <img src="picture/mail.png" alt="メール文面" style="max-width:100%; height: auto;">
            </div>
                <div style="text-align: left; font-size: 1.1em; margin-top: 0.25rem;">メール内リンクをクリック</div><br>
            <div style="max-width: 600px;">
                <img src="picture/ayashii.png" alt="認証画面" style="max-width:100%; height: auto;">
            </div>
                <div style="text-align: left; font-size: 1.1em; margin-top: 0.25rem;">[COMPLETE VERIFICATION]をクリック</div>
          </details>
        </ul>
      </div>

      <div class="toplink-margin">
        <a href="index.html">TOPに戻る</a>
      </div>
      
      <div class="top-section-box">
        <div class="authInput">
          <input type="email" id="email" placeholder="メールアドレス"><br>
          <input type="password" id="password" placeholder="パスワード"><br>
        </div>
        <button id="registerBtn">登録</button>
        <p><a href="dbr_ir_upload.html">ログインはこちら</a></p>
      </div>
    </center>

    <script type="module">
      import { auth, signOut, createUserWithEmailAndPassword, sendEmailVerification, translateAuthError } from "./main.js";

      document.getElementById("registerBtn").onclick = async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        if (!email || !password) return alert("メールアドレスとパスワードを入力してください。");

         try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);

          // メールアドレス確認メール送信
          await sendEmailVerification(userCredential.user);

          // 一旦ログアウト
          await auth.signOut();

          alert("確認メールを送信しました。メール内のリンクをクリックして登録を完了してください。");

          // パスワード入力画面へ誘導する（ログインはまだ不可）
          location.href = "dbr_ir_upload.html";

        } catch (e) {
          alert("登録に失敗しました。: " + translateAuthError(e));
        }
      };
    </script>
  </body>
</html>
